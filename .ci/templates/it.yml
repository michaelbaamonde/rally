---

- job:
    name: "elastic+rally+{jobname}+{branch}-it"
    display-name: "elastic / rally # {branch} - {jobname}+it"
    description: "Integration tests for elastic/rally "
    concurrent: true
    scm:
      - git:
          refspec: +refs/pull/*:refs/remotes/origin/pr/*
    publishers:
      - google-cloud-storage:
          credentials-id: 'internal-ci-gcs-plugin'
          uploads:
            - classic:
                file-pattern: '.esbench/$BUILD_NUMBER.tar.bz2'
                storage-location: 'gs://internal-ci-artifacts/jobs/$JOB_NAME'
                share-publicly: false
                upload-for-failed-jobs: true
                show-inline: true
    builders:
      - shell: |
          #!/usr/local/bin/runbld
          set -o errexit
          bash .ci/build.sh it
          bash .ci/build.sh archive
